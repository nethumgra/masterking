<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Account - TUTU</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Poppins', 'sans-serif'] },
                    colors: {
                        'tutu-rose': {
                            light: '#ffe4e6', DEFAULT: '#e11d48', dark: '#be123c',
                        },
                        'tutu-bg': '#fff1f2',
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        body { @apply font-sans text-gray-800 bg-tutu-bg; }
        
        /* Tab Buttons */
        .page-tab-btn {
            @apply w-1/2 text-center pb-4 font-semibold text-gray-400 border-b-2 border-transparent transition-colors cursor-pointer hover:text-tutu-rose;
        }
        .page-tab-btn.active {
            @apply text-tutu-rose border-tutu-rose font-bold;
        }
        
        .form-input {
            @apply block w-full p-3 border border-rose-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-tutu-rose focus:border-transparent bg-white/50 transition-all;
        }

        /* User Type Radio Label - Adjusted for 3 items */
        .user-type-label {
            @apply flex flex-col items-center justify-center text-center p-3 rounded-xl cursor-pointer bg-white border border-rose-100 text-gray-500 transition-all hover:border-tutu-rose hover:text-tutu-rose text-xs sm:text-sm h-full;
        }
        .user-type-label i {
            @apply text-lg mb-1;
        }
        .user-type-label:has(input:checked) {
            @apply bg-rose-50 border-tutu-rose text-tutu-rose font-bold shadow-sm ring-1 ring-tutu-rose;
        }

        /* Drawer Styles */
        .drawer-overlay { @apply fixed inset-0 bg-black/50 z-50 opacity-0 pointer-events-none transition-opacity; }
        .drawer-content { @apply fixed top-0 right-0 h-full bg-white shadow-2xl z-50 w-80 translate-x-full transition-transform duration-300; }
        .drawer.open .drawer-overlay { @apply opacity-100 pointer-events-auto; }
        .drawer.open .drawer-content { @apply translate-x-0; }
        
        /* Mobile Nav */
        .mobile-nav-link.active { @apply text-tutu-rose font-bold; }
    </style>
</head>
<body class="pb-20 md:pb-0 flex flex-col min-h-screen"> 
    
    <div id="page-loader" class="fixed top-0 left-0 w-0 h-1 bg-tutu-rose z-[9999] transition-all duration-300 ease-linear"></div>
    
    <header class="bg-white/80 backdrop-blur-md shadow-sm sticky top-0 z-40 hidden md:block border-b border-rose-100">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
             <a href="/" id="logo-link" class="text-3xl font-black uppercase tracking-widest hover:opacity-80 transition-opacity">
              <span class="text-tutu-rose">TU</span><span class="text-gray-800">TU</span>
            </a>
            
            <nav class="hidden md:flex space-x-8">
                <a href="index.html" class="font-semibold text-gray-600 hover:text-tutu-rose transition-colors">Home</a>
                <a href="shop.html" class="font-semibold text-gray-600 hover:text-tutu-rose transition-colors">Shop</a>
                <a href="stories.html" class="font-semibold text-gray-600 hover:text-tutu-rose transition-colors">Stories</a>
            </nav>

            <div class="flex items-center space-x-8">
                <a href="account.html" id="desktop-account-btn" class="flex flex-col items-center text-tutu-rose transition-colors">
                    <i class="fa fa-user text-xl"></i>
                </a>
                <button id="desktop-cart-btn" class="flex flex-col items-center text-gray-500 hover:text-tutu-rose relative transition-colors">
                    <i class="fa fa-shopping-cart text-xl"></i>
                    <span id="cart-count-badge" class="absolute -top-2 -right-2 bg-tutu-rose text-white text-[10px] font-bold rounded-full px-1.5 border-2 border-white">0</span>
                </button>
            </div>
        </div>
    </header>

    <header class="bg-white shadow-md sticky top-0 z-40 flex md:hidden items-center justify-between p-4 px-6">
        <button id="mobile-menu-btn" class="text-2xl text-gray-600">
            <i class="fa fa-bars"></i>
        </button>
         <a href="/" id="mobile-logo-link" class="text-2xl font-black uppercase tracking-widest">
            <span class="text-tutu-rose">TU</span><span class="text-gray-800">TU</span>
        </a>
        <div class="w-8"></div> 
    </header>

    <main class="flex-grow flex items-center justify-center p-4 md:p-8">
        <div class="max-w-4xl w-full bg-white shadow-xl rounded-3xl overflow-hidden md:grid md:grid-cols-2 border border-rose-100">
            
            <div class="p-8 md:p-12 flex flex-col justify-center">
                <div class="max-w-md mx-auto w-full">
                    
                    <div class="flex border-b border-gray-100 mb-8">
                        <button id="login-tab-btn" class="page-tab-btn active">Login</button>
                        <button id="register-tab-btn" class="page-tab-btn">Register</button>
                    </div>

                    <div id="login-form-container" class="animate-fade-in">
                        <div class="text-center mb-6">
                            <h2 class="text-2xl font-bold text-gray-800">Welcome Back</h2>
                            <p class="text-sm text-gray-500">Sign in to continue shopping</p>
                        </div>
                        
                        <form id="login-form" class="space-y-5">
                            <div>
                                <label for="login-email" class="block text-sm font-bold text-gray-700 mb-1">Email Address</label>
                                <input type="email" id="login-email" required class="form-input" placeholder="hello@example.com">
                            </div>
                            <div>
                                <label for="login-password" class="block text-sm font-bold text-gray-700 mb-1">Password</label>
                                <input type="password" id="login-password" required class="form-input" placeholder="••••••••">
                            </div>
                            
                            <button type="submit" class="w-full bg-tutu-rose text-white p-4 rounded-xl hover:bg-tutu-rose-dark font-bold text-lg shadow-lg shadow-rose-200 transition-all transform active:scale-95">
                                Login Now
                            </button>
                            <p id="login-error" class="text-red-500 text-sm text-center font-medium h-5"></p>
                        </form>
                    </div>

                    <div id="register-form-container" class="hidden animate-fade-in">
                        <div class="text-center mb-4">
                            <h2 class="text-2xl font-bold text-gray-800">Create Account</h2>
                            <p class="text-sm text-gray-500">Join our community today</p>
                        </div>

                        <div class="grid grid-cols-3 gap-2 mb-6">
                            <label class="user-type-label">
                                <input type="radio" name="userType" value="customer" class="hidden" checked> 
                                <i class="fa fa-shopping-bag"></i> Customer
                            </label>
                            <label class="user-type-label">
                                <input type="radio" name="userType" value="affiliate" class="hidden"> 
                                <i class="fa fa-bullhorn"></i> Affiliate
                            </label>
                            <label class="user-type-label">
                                <input type="radio" name="userType" value="reseller" class="hidden"> 
                                <i class="fa fa-handshake"></i> Reseller
                            </label>
                        </div>

                        <form id="register-form" class="space-y-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Full Name</label>
                                <input type="text" id="reg-name" required class="form-input" placeholder="Your Name">
                            </div>

                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Email Address</label>
                                <input type="email" id="reg-email" required class="form-input" placeholder="hello@example.com">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-700 mb-1">Password</label>
                                <input type="password" id="reg-password" required class="form-input" placeholder="Min. 6 characters">
                            </div>

                            <div id="affiliate-fields" class="hidden space-y-3 pt-3 border-t border-rose-100 bg-rose-50/50 p-4 rounded-xl animate-fade-in">
                                <h3 id="social-fields-title" class="text-sm font-bold text-tutu-rose">Affiliate Details</h3>
                                <p class="text-xs text-gray-500">Add your social media to get verified faster.</p>
                                <input type="url" id="reg-youtube" placeholder="YouTube Channel Link (Optional)" class="form-input text-sm">
                                <input type="url" id="reg-facebook" placeholder="Facebook Page Link (Optional)" class="form-input text-sm">
                                <input type="url" id="reg-tiktok-insta" placeholder="TikTok/Instagram Link (Optional)" class="form-input text-sm">
                            </div>

                            <button type="submit" class="w-full bg-tutu-rose text-white p-4 rounded-xl hover:bg-tutu-rose-dark font-bold text-lg shadow-lg shadow-rose-200 transition-all transform active:scale-95 mt-2">
                                Create Account
                            </button>
                            <p id="register-error" class="text-red-500 text-sm text-center font-medium h-5"></p>
                        </form>
                    </div>
                </div>
            </div>

            <div class="hidden md:block relative bg-rose-50 overflow-hidden">
                <img src="https://images.unsplash.com/photo-1483985988355-763728e1935b?q=80&w=2070&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover transition-transform duration-[20s] hover:scale-110" alt="Fashion">
                <div class="absolute inset-0 bg-gradient-to-t from-tutu-rose/90 to-transparent mix-blend-multiply"></div>
                <div class="absolute bottom-0 left-0 p-12 text-white">
                    <h3 class="text-4xl font-extrabold mb-3 leading-tight">Join the Revolution</h3>
                    <p class="text-rose-100 text-lg opacity-90">Whether you're shopping or partnering – TUTU is the place for you.</p>
                </div>
            </div>
        </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 h-16 bg-white/90 backdrop-blur-md border-t border-rose-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] flex justify-around items-center z-40 md:hidden">
        <a href="index.html" class="mobile-nav-link flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-tutu-rose text-xs transition-colors">
            <i class="fa fa-store text-xl mb-1"></i><span>Shop</span>
        </a>
        <a href="stories.html" class="mobile-nav-link flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-tutu-rose text-xs transition-colors">
            <i class="fa fa-book-open text-xl mb-1"></i><span>Stories</span>
        </a>
        <a href="wishlist.html" class="mobile-nav-link flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-tutu-rose text-xs relative transition-colors">
            <div class="relative"><i class="fa fa-heart text-xl mb-1"></i><span id="mobile-wishlist-badge" class="absolute -top-1 -right-2 bg-tutu-rose text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center">0</span></div><span>Wishlist</span>
        </a>
        <button id="mobile-cart-btn" class="mobile-nav-link flex-1 flex flex-col items-center justify-center text-gray-400 hover:text-tutu-rose text-xs relative transition-colors">
            <div class="relative"><i class="fa fa-shopping-bag text-xl mb-1"></i><span id="mobile-cart-badge" class="absolute -top-1 -right-2 bg-tutu-rose text-white text-[10px] font-bold rounded-full h-4 w-4 flex items-center justify-center">0</span></div><span>Cart</span>
        </button>
        <a href="account.html" class="mobile-nav-link active flex-1 flex flex-col items-center justify-center text-tutu-rose text-xs font-bold transition-colors">
            <i class="fa fa-user text-xl mb-1"></i><span>Account</span>
        </a>
    </nav>

    <div id="account-drawer-modal" class="drawer drawer-modal fixed inset-0 z-50 hidden">
        <div id="account-drawer-bg" class="drawer-overlay fixed inset-0 bg-black/50 opacity-0 transition-opacity"></div>
        <div id="account-drawer" class="drawer-content fixed top-0 right-0 h-full bg-white shadow-2xl z-50 w-80 translate-x-full transition-transform duration-300">
            <div id="account-drawer-logged-in" class="hidden flex flex-col h-full">
                <div class="p-5 flex justify-between items-center border-b border-rose-100 bg-rose-50/30">
                    <h2 class="text-xl font-bold text-gray-800">My Account</h2>
                    <button id="close-account-drawer-btn-logged-in" class="text-gray-500 hover:text-tutu-rose"><i class="fas fa-times text-xl"></i></button>
                </div>
                <div class="flex-grow p-6 overflow-y-auto">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mx-auto mb-3 text-tutu-rose text-2xl">
                            <i class="fas fa-user"></i>
                        </div>
                        <p class="text-gray-500 text-sm">Welcome back,</p>
                        <h3 id="account-drawer-user-email" class="text-md font-semibold text-gray-800 break-words mt-1"></h3>
                    </div>
                    <button id="drawer-logout-btn" class="w-full text-center bg-gray-100 text-gray-600 p-3 rounded-xl hover:bg-gray-200 font-bold text-base transition-colors">Logout</button>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-drawer" class="drawer">
        <div class="drawer-overlay" id="cart-drawer-overlay"></div>
        <div class="drawer-content flex flex-col">
            <div class="flex justify-between items-center p-5 border-b border-rose-100 bg-rose-50/30">
                <h2 class="text-xl font-bold text-gray-800">Shopping Cart</h2>
                <button id="cart-drawer-close" class="text-gray-500 hover:text-tutu-rose"><i class="fas fa-times text-xl"></i></button>
            </div>
            <div id="cart-drawer-items-container" class="flex-grow p-6 overflow-y-auto text-center flex flex-col justify-center">
                <i class="fas fa-shopping-basket text-rose-200 text-6xl mb-4"></i>
                <p class="text-gray-500 font-medium">Your cart is empty.</p>
            </div>
            <div class="p-6 border-t border-rose-100 bg-rose-50/50">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-lg font-medium text-gray-600">Subtotal:</span>
                    <span id="cart-drawer-total" class="text-2xl font-bold text-tutu-rose">Rs. 0.00</span>
                </div>
                <div class="flex flex-col gap-3">
                    <a href="cart.html" class="w-full bg-white border-2 border-tutu-rose text-tutu-rose p-3 rounded-xl hover:bg-rose-50 font-bold text-center transition-colors">View Cart</a>
                    <a href="checkout.html" class="w-full bg-tutu-rose text-white p-3 rounded-xl hover:bg-tutu-rose-dark font-bold text-center transition-colors shadow-lg shadow-rose-200">Checkout</a>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, onSnapshot, setDoc, serverTimestamp, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDKFinkyjgys2HOO_QpRoMosGYyTFEcIgE",
            authDomain: "masterking-fa629.firebaseapp.com",
            projectId: "masterking-fa629",
            storageBucket: "masterking-fa629.firebasestorage.app",
            messagingSenderId: "680021576286",
            appId: "1:680021576286:web:52769441eeda5ab56f02cf",
            measurementId: "G-9443L8L88Q"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app); 
        const usersPath = `/users`; 

        let currentUser = null;

        function captureAffiliateRef() {
            const urlParams = new URLSearchParams(window.location.search);
            const affiliateId = urlParams.get('ref');
            if (affiliateId) {
                console.log(`Affiliate ID captured: ${affiliateId}`);
                localStorage.setItem('affiliateRef', affiliateId);
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('page-loader').style.width = '100%';
            setTimeout(() => document.getElementById('page-loader').style.display = 'none', 500);
            
            setupTabLogic();
            setupMobileDrawers();
            captureAffiliateRef();
            attachCartDrawerListener(null);
        });

        // Auth State & Redirect Logic
        onAuthStateChanged(auth, async (user) => {
            currentUser = user;
            if (user) {
                // If user is logged in, check role and redirect
                const loginContainer = document.getElementById('login-form-container');
                const registerContainer = document.getElementById('register-form-container');
                
                // Only redirect if we are visible on the login/register forms
                if (!loginContainer.classList.contains('hidden') || !registerContainer.classList.contains('hidden')) {
                     await redirectUserBasedOnRole(user);
                }

                document.getElementById('account-drawer-logged-in').classList.remove('hidden');
                document.getElementById('account-drawer-logged-in').classList.add('flex');
                document.getElementById('account-drawer-user-email').textContent = user.email;
                attachCartDrawerListener(user.uid);
            } else {
                attachCartDrawerListener(null);
            }
        });

        async function redirectUserBasedOnRole(user) {
            console.log("Checking user role...");
            const userDocRef = doc(db, usersPath, user.uid);
            const userDocSnap = await getDoc(userDocRef);
            
            if (userDocSnap.exists()) {
                const userData = userDocSnap.data();
                
                // Priority Redirects (Seller removed)
                if (userData.isAffiliate === true || userData.wantsToBeAffiliate === true) {
                    window.location.href = 'affiliate-dashboard.html';
                } else if (userData.role === 'reseller' || userData.wantsToBeReseller === true) {
                    window.location.href = 'reseller-dashboard.html'; 
                } else {
                    window.location.href = 'customer-account.html';
                }
            } else {
                window.location.href = 'customer-account.html';
            }
        }

        function setupTabLogic() {
            const loginTab = document.getElementById('login-tab-btn');
            const registerTab = document.getElementById('register-tab-btn');
            const loginForm = document.getElementById('login-form-container');
            const registerForm = document.getElementById('register-form-container');

            loginTab.addEventListener('click', () => {
                loginTab.classList.add('active'); registerTab.classList.remove('active');
                loginForm.classList.remove('hidden'); registerForm.classList.add('hidden');
            });

            registerTab.addEventListener('click', () => {
                registerTab.classList.add('active'); loginTab.classList.remove('active');
                registerForm.classList.remove('hidden'); loginForm.classList.add('hidden');
            });

            // Toggle Fields based on User Type Radio
            const userTypeRadios = document.querySelectorAll('input[name="userType"]');
            const affiliateFields = document.getElementById('affiliate-fields');
            const socialTitle = document.getElementById('social-fields-title');
            
            userTypeRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    const userType = e.target.value;
                    
                    // Reset
                    affiliateFields.classList.add('hidden');

                    if (userType === 'affiliate') {
                        affiliateFields.classList.remove('hidden');
                        socialTitle.textContent = "Affiliate Details";
                    } else if (userType === 'reseller') {
                        affiliateFields.classList.remove('hidden');
                        socialTitle.textContent = "Reseller Details";
                    }
                });
            });

            // Login Submit
            document.getElementById('login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                const errorEl = document.getElementById('login-error');
                errorEl.textContent = "Signing in...";

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                } catch (err) {
                    errorEl.textContent = "Invalid email or password.";
                    console.error(err);
                }
            });

            // Register Submit (Handles 3 Roles)
            document.getElementById('register-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const errorEl = document.getElementById('register-error');
                errorEl.textContent = "Creating account...";

                const userType = document.querySelector('input[name="userType"]:checked').value;
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const password = document.getElementById('reg-password').value;

                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    const batch = writeBatch(db);
                    const userDocRef = doc(db, usersPath, user.uid);
                    
                    let userData = {
                        name: name,
                        email: email,
                        createdAt: serverTimestamp(),
                        isSeller: false,
                        isAffiliate: false,
                        wantsToBeAffiliate: false,
                        wantsToBeSeller: false,
                        role: "customer" // Default
                    };

                    if (userType === 'customer') {
                        // Default data is enough
                    } 
                    else if (userType === 'affiliate') {
                        const youtube = document.getElementById('reg-youtube').value;
                        const facebook = document.getElementById('reg-facebook').value;
                        const tiktokInsta = document.getElementById('reg-tiktok-insta').value;
                        
                        userData.wantsToBeAffiliate = true;
                        userData.affiliateCode = user.uid;
                        userData.socialMedia = {
                            youtube: youtube || null,
                            facebook: facebook || null,
                            tiktok_insta: tiktokInsta || null
                        };
                    } 
                    else if (userType === 'reseller') {
                        const youtube = document.getElementById('reg-youtube').value;
                        const facebook = document.getElementById('reg-facebook').value;
                        const tiktokInsta = document.getElementById('reg-tiktok-insta').value;
                        
                        userData.role = "reseller";
                        userData.wantsToBeReseller = true;
                        userData.socialMedia = {
                            youtube: youtube || null,
                            facebook: facebook || null,
                            tiktok_insta: tiktokInsta || null
                        };
                    }

                    batch.set(userDocRef, userData);
                    await batch.commit();
                    errorEl.textContent = "";
                    
                    // Redirect logic
                    if (userType === 'affiliate') {
                        window.location.href = 'affiliate-dashboard.html';
                    } else if (userType === 'reseller') {
                        window.location.href = 'reseller-dashboard.html';
                    } else {
                        window.location.href = 'customer-account.html';
                    }

                } catch (err) {
                    errorEl.textContent = err.message.replace('Firebase: ', '');
                    console.error(err);
                }
            });
        }

        // Drawer & Cart Logic
        function setupMobileDrawers() {
            const cartDrawer = document.getElementById('cart-drawer');
            const accountDrawer = document.getElementById('account-drawer-modal');
            const toggleCart = () => cartDrawer.classList.toggle('open');
            
            document.getElementById('mobile-cart-btn')?.addEventListener('click', toggleCart);
            document.getElementById('desktop-cart-btn')?.addEventListener('click', toggleCart);
            document.getElementById('cart-drawer-close')?.addEventListener('click', toggleCart);
            document.getElementById('cart-drawer-overlay')?.addEventListener('click', toggleCart);

            const closeAccount = () => accountDrawer.classList.add('hidden');
            const openAccount = (e) => {
                e.preventDefault();
                if(currentUser) accountDrawer.classList.remove('hidden');
            };

            document.getElementById('desktop-account-btn')?.addEventListener('click', openAccount);
            document.getElementById('close-account-drawer-btn-logged-in')?.addEventListener('click', closeAccount);
            document.getElementById('account-drawer-bg')?.addEventListener('click', closeAccount);
            
            document.getElementById('drawer-logout-btn')?.addEventListener('click', async () => {
                await signOut(auth);
                closeAccount();
                window.location.reload();
            });
        }

        function attachCartDrawerListener(userId) {
            const container = document.getElementById('cart-drawer-items-container');
            const totalEl = document.getElementById('cart-drawer-total');
            const badges = [document.getElementById('cart-count-badge'), document.getElementById('mobile-cart-badge')];
            
            if (!container || !totalEl) return;
            
            if (!userId) {
                container.innerHTML = '<p class="text-gray-500">Please log in to see your cart.</p>';
                totalEl.textContent = 'Rs. 0.00';
                badges.forEach(b => { if(b) b.textContent = '0' });
                return;
            }

            onSnapshot(collection(db, usersPath, userId, 'cart'), (snapshot) => {
                let count = snapshot.size;
                badges.forEach(b => { if(b) b.textContent = count });
                
                let subtotalLKR = 0;
                if (snapshot.empty) {
                    container.innerHTML = '<p class="text-gray-500">Your cart is empty.</p>';
                } else {
                    container.innerHTML = ''; 
                    snapshot.forEach(doc => {
                        const item = doc.data();
                        subtotalLKR += (parseFloat(item.price) || 0) * (parseInt(item.quantity) || 1);
                        const itemDiv = document.createElement('div');
                        itemDiv.className = "flex justify-between items-center mb-3 border-b border-rose-50 pb-2";
                        itemDiv.innerHTML = `<span class="text-sm font-medium">${item.name || 'Item'}</span> <span class="text-tutu-rose font-bold text-sm">x${item.quantity}</span>`;
                        container.appendChild(itemDiv);
                    });
                }
                totalEl.textContent = `Rs. ${subtotalLKR.toFixed(2)}`;
            });
        }
    </script>
</body>
</html>